{% extends "base.html" %}
{% import "macro.html" as macros %}
{% block head %}
{% endblock %}
{% block menu %}
    <li class="menu" onclick="location.href='/modifier/{{ aireDeJeux.indice|e }}'" style="cursor: pointer">Modifier</li>
{% endblock %}
{% block content %}
<div id="title" class="highlight title_detail">
    <div id="ville">{{ aireDeJeux.ville|e }}</div>
    <div id="name">{{ aireDeJeux.nom|e }}</div>
</div>
<div id="content">
    <div id="stars">
        {% for i in range(5) %}
        <svg width="22" height="22" class="stars">
            {% if aireDeJeux.score and aireDeJeux.score > i %}
                <circle cx="11" cy="11" r="10" stroke=#64b5f6 stroke-width="1" fill="yellow" />{{i}}
            {% else %}
                <circle cx="11" cy="11" r="10" stroke=#64b5f6 stroke-width="1" fill=#bbdefb />{{i}}
            {% endif %}
        </svg>
        {% endfor %}
    </div>
    <div class="contenant">
        <div class="contenue">
            <div id="horraire" class="bigger horizontal">
                <div class="inside">Horaire:</div><div class="inside">{{ aireDeJeux.horaires|e }}</div>
            </div>
            <div id="age" class="bigger horizontal">
                <div class="inside">Age:</div><div class="inside">{{ aireDeJeux.age|e }}</div>
            </div>
            <div id="box-activitees" class="box">
                <div id="title-activitee" class="bigger highlight">Activités:</div>
                <div id="list-activitees">
                    {% for activite in aireDeJeux.activites %}
                        <div class="activitee">{{ activite|e }}</div>
                    {% endfor %}
                </div>
            </div>
            <div id="box-acces" class="box">
                <div id="title-accessibilite" class="bigger highlight">Accessibilité</div>
                <div id="description-accessibilte">{{ aireDeJeux.accessibilite|e }}</div>
            </div>
            <div id="description" class="box">
            <div class="bigger highlight">
                Description:
            </div>
            <p class="description">
                {{ aireDeJeux.description|e }}
            </p>
            </div>
            <div id="commentaires" class="box">
                <div class="bigger highlight horizontal">
                    <div>Commentaire(s): </div>
                    <div class="center"> </div><div class="plus" onclick="new_commentaire()"> + </div>
                </div>
                <div id="new_comment" style="display: none">
                    <iframe src="/add_comment?key={{ aireDeJeux.key }}" onload="update_comment()"
                    id="iframAddComment"></iframe>
                </div>
                <div id="liste_commentaires">
                {% if listCommentaires %}
                    {% for commentaire in listCommentaires %}
                    <p class="commentaire">
                        {{ commentaire.commentaire|e }}
                    </p>
                    {% endfor %}
                {% endif %}
                </div>
            </div>
        </div>
        <div class="contenue">
            <div class="ratio23outside box">
            <div class="ratio23inside">
            <div id="debloquerMap" onclick="active_map();" style="visibility: hidden">débloquer</div>
            <div id="map"></div></div></div>
            {{ macros.photos(listImage, aireDeJeux.indice) }}
        </div>
    </div>
</div>
<script type="text/javascript">
    function initialize(lat, lon) {
        var mapCanvas = document.getElementById("map");
        var myLatLng = {lat: lat, lng: lon};
        var styles =  [ { "stylers": [ { "saturation": 5 }, { "lightness": -5 },
        { "gamma": 1.16 }, { "hue": "#004cff" } ] } ];
        var styledMap = new google.maps.StyledMapType(styles,
    {name: "Styled Map"});

        var mapOption = {
            center: myLatLng,
            streetViewControl: false,
            scrollwheel: true,
            draggable: true,
            zoom: 15,
            mapTypeIds:[google.maps.MapTypeId.ROADMAP, 'map_style']
        }
        var map = new google.maps.Map(mapCanvas, mapOption);
        map.mapTypes.set('map_style', styledMap);
        map.setMapTypeId('map_style');
        var marker = new google.maps.Marker({
            position: myLatLng,
            map: map,
        });
        return map;
    }
    function initMap() {
        map = initialize({{ aireDeJeux.coordonnees.lat if aireDeJeux.coordonnees.lat else aireDeJeux.coordonnees_ville.lat}},
            {{ aireDeJeux.coordonnees.lon if aireDeJeux.coordonnees.lon else aireDeJeux.coordonnees_ville.lon}});
        if (screen.width<700) {
            map.setOptions({ scrollwheel: false });
            map.setOptions({ draggable: false });
            document.getElementById("debloquerMap").style.visibility = "visible";
        }
    }
    function new_commentaire(){
        document.getElementById("new_comment").style.display="block";

    }
    var pas_de_nouveau_commentaire = "true";
    function update_comment(){
        if (pas_de_nouveau_commentaire == "true") {
            pas_de_nouveau_commentaire = "false";
        } else {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function() {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    json = xmlhttp.responseText;
                    liste_commentaires = JSON.parse(json);
                    var out = "";
                    template = "<p class='commentaire'>%commentaire%</p>";
                    for (i=0; i<liste_commentaires.length; i++) {
                        new_comment = template.replace('%commentaire%', liste_commentaires[i]);
                        out += new_comment;
                    }
                    document.getElementById("new_comment").style.display="none";
                    document.getElementById("liste_commentaires").innerHTML = out;
                }
            }
            xmlhttp.open("GET", "/listeCommentaire?q=" + "{{aireDeJeux.key}}", true);
            xmlhttp.send();
        }
    }
    function active_map() {
        console.log("test")
        map.setOptions({ scrollwheel: true, draggable: true});
    }
</script>
<script async defer
         src="https://maps.googleapis.com/maps/api/js?callback=initMap">
</script>
{% endblock %}