{% extends "base.html" %}
{% import "macro.html" as macros %}
{% import "mapStyle.html" as mapStyle %}
{% block head %}
    <title>Aire de jeux {{ aireDeJeux.nom|e }} à {{ aireDeJeux.ville }}  </title>
    <meta name="description" content="Informations tel que la localisation, les activités, les heurs d'ouvertures
    et des photos de l'aire de jeux {{ aireDeJeux.nom|e }} à {{ aireDeJeux.ville }}">
{% endblock %}
{% block menu %}
    <li class="menu" style="cursor: pointer">
        <a href="{{host}}/modifier/{{ aireDeJeux.indice|e }}">Modifier</a>
    </li>
    <li class="menu" style="cursor: pointer">
        <a href='{{host}}/créerAireDeJeux?keyVille={{ aireDeJeux.key_ville }}'>Ajouter</a>
    </li>
{% endblock %}
{% block content %}
<h1 id="title" class="highlight title_detail">
    <div id="ville">
        <a href="{{host}}/aireDeJeux/{{ aireDeJeux.departement }}/{{ aireDeJeux.ville }}">{{ aireDeJeux.ville|e }}</a>
    </div>
    <div id="name">{{ aireDeJeux.nom|e }}</div>
</h1>
<div id="content">
    <div id="stars">
        {% for i in range(5) %}
        <svg width="22" height="22" class="stars">
            {% if aireDeJeux.score and aireDeJeux.score > i %}
                <circle cx="11" cy="11" r="10" stroke=#64b5f6 stroke-width="1" fill="yellow" />{{i}}
            {% else %}
                <circle cx="11" cy="11" r="10" stroke=#64b5f6 stroke-width="1" fill=#bbdefb />{{i}}
            {% endif %}
        </svg>
        {% endfor %}
    </div>
    <div class="contenant">
        <div class="contenue">
            <div id="horraire" class="bigger horizontal">
                <div class="inside">Horaire:</div><div class="inside">{{ aireDeJeux.horaires|e if aireDeJeux.horaires|e != 'None' }}</div>
            </div>
            <div id="age" class="bigger horizontal">
                <div class="inside">Age:</div><div class="inside">{{ aireDeJeux.age|e if aireDeJeux.age|e != 'None' }}</div>
            </div>
            <div id="adresse" class="bigger horizontal">
                <div class="inside">Adresse:</div><div class="inside">{{ aireDeJeux.adresse|e if aireDeJeux.adresse|e != 'None' }}</div>
            </div>
            <div id="box-activitees" class="box">
                <div id="title-activitee" class="bigger highlight">Activités:</div>
                <div id="list-activitees">
                    {% for activite in aireDeJeux.activites %}
                        <div class="activitee">{{ activite|e }}</div>
                    {% endfor %}
                </div>
            </div>
            <div id="description" class="box">
                <div class="bigger highlight">Description:</div>
                <p class="description">
                    {{ aireDeJeux.description|e if aireDeJeux.description|e != "None" }}
                </p>
            </div>
            <div id="website" class="horizontal">
                <p class="inside">Website:<a class="inside" href="{{ aireDeJeux.website|e if aireDeJeux.website|e != 'None' }}">
                    {{ aireDeJeux.website|e if aireDeJeux.website|e != 'None' }}</a></p>
            </div>
            <div id="box-acces" class="box">
                <div id="title-accessibilite" class="bigger highlight">Accessibilité</div>
                <div id="description-accessibilte">
                    {{ aireDeJeux.accessibilite|e if aireDeJeux.accessibilite|e != "None" }}
                </div>
            </div>
            <div id="commentaires" class="box">
                <div class="bigger highlight horizontal">
                    <div>Commentaire(s): </div>
                    <div class="center"> </div><div class="plus" onclick="new_commentaire()"> + </div>
                </div>
                <div id="new_comment" style="display: none">
                    <iframe src="/add_comment?key={{ aireDeJeux.key }}" onload="update_comment()"
                    id="iframAddComment"></iframe>
                </div>
                <div id="liste_commentaires">
                {% if listCommentaires %}
                    {% for commentaire in listCommentaires %}
                    <p class="commentaire">
                        {{ commentaire.commentaire|e }}
                    </p>
                    {% endfor %}
                {% endif %}
                </div>
            </div>
        </div>
        <div class="contenue">
            <div class="ratio23outside box">
                <div id="debloquerMap" onclick="active_map();" style="visibility: hidden">débloquer</div>
                <div class="ratio23inside">
                    <div id="map"></div>
                </div>
            </div>
            {{ macros.photos(listImage, aireDeJeux.indice) }}
        </div>
    </div>
</div>
{% endblock %}
{% block script %}
<script type="text/javascript">
    {% if aireDeJeux.coordonnees.lat %}
        {{ mapStyle.script(aireDeJeux.coordonnees, 15) }}
        function initMarker() {
            {{ mapStyle.addMarker(aireDeJeux.coordonnees, aireDeJeux.url, aireDeJeux.nom) }}
        }
    {% else %}
        {{ mapStyle.script(aireDeJeux.coordonnees_ville, 15) }}
        function initMarker() {
        }
    {% endif %}

    function new_commentaire(){
    document.getElementById("new_comment").style.display="block";
    }

    var pas_de_nouveau_commentaire = "true";
    function update_comment(){
        if (pas_de_nouveau_commentaire == "true") {
            pas_de_nouveau_commentaire = "false";
        } else {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function() {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    json = xmlhttp.responseText;
                    liste_commentaires = JSON.parse(json);
                    var out = "";
                    template = "<p class='commentaire'>%commentaire%</p>";
                    for (i=0; i<liste_commentaires.length; i++) {
                        new_comment = template.replace('%commentaire%', liste_commentaires[i]);
                        out += new_comment;
                    }
                    document.getElementById("new_comment").style.display="none";
                    document.getElementById("liste_commentaires").innerHTML = out;
                }
            }
            xmlhttp.open("GET", "/liste/Commentaire?q=" + "{{aireDeJeux.key}}", true);
            xmlhttp.send();
        }
    }
</script>
<script async defer
         src="https://maps.googleapis.com/maps/api/js?callback=initMap">
</script>
{% endblock %}